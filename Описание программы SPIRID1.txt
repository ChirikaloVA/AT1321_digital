Описание программы SPRD

Программа SPRD предназначена для обеспечения всех функций гамма-спектрометра МКГ-АТ1321. Программа работает в составе спектрометра и прошивается во встроенный процессор ARM7.


Программа разработана в среде IAR Embedded Workbench IDE 5.4 for ARM. Для работы необходим ПК с Windows XP или старше. См. требования на IAR Embedded Workbench IDE 5.4 for ARM.
В ней же компилируется, линкуется и прошивается через интерфейс JTAG, используя JLink.

Программа компилируется в четырех версиях: с библиотекой по умолчанию с ядерными материалами и без ядерных материалов, а также для GPS приемника со скоростью передачи данных 4800 или 9600 бод.
На выходе получаются четыре загрузочных модуля: SPiRiD1SNM.hex, SPiRiD1.hex SPiRiD1SNMGPS9600.hex и SPiRiD1GPS9600.hex.

Для прошивки загрузочного модуля без интерфейса JTAG используется bootloader самого процессора и RS232 (USB>Serial) соединение с прибором,
а также программа at200.exe и написанные для прошивки исполняемые bat файлы ProgCom1.bat и ProgCom1_SNM.bat, в которых все настройки для данной прошивки и процессора. 
Если нужно прошить прошивку для GPS со скоростью обмена данными 9600 бод, то имена файлов в bat файлах следует заменить.

Для прошивки программы необходимо использовать документ "Руководство по программированию МКГ-АТ1321.doc".




версия 3.7
05/12/2011
в режиме стаблизации, после устновки кода усиления в 0 в самом начале цикла переходим в режим ожидания установки усиления, а не набора спектра


версия 3.8
26-29/12/2011
добавлено перечитывание сектора ЕЕПРОМ при ошибке
увеличено количество попыток связи со вторым процессором


версия 3.9
07/03/2012
изменена библиотека нуклидов, приведена в соответствии с АТ6101С


версия 3.10
06/07/2012 
added calculation of reosultion in energies


версия 3.11
27/08/2012
изменено выключение по разряду батарей, теперь звуковой сигнал не будет подаваться чтобы избежать неожиданного обесточивания.
при определении разряженой батареи звуковые сигналы больше не подаются, кроме звука разряда батареи и нажатий кнопок.
запрещена операция запроса на очистку памяти если нет свободной и разряжена батарея


версия 4.0(A)(B)
11/10/2012
-резервированием таблиц кластеров и файлов и восстановление их при сбое
-новая система ведения версий
-кодирование версий: главный номер, точка, второстепенный номер, буква исполнения
буква исполнения:
A  - ядерные исполнения
B  - безядерные исполнения
-исправлено зависание в режиме удаления многих файлов (очистка памяти от выбраных типов файлов) в случае разряда батарей.
-исправлена ошибка восстановления файловой системы изза сбойных файлов (уделение их).
-сделана поддержка system.bak как резервной заводской копии файла system.ini.
в случае сбоя последнего или ручного сброса на заводские установки идет восстановление из резерва.
только полный сброс удалит и резервную копию
-проверка форматированности всей памяти перенесено в конец всего списка проверок памяти, иначе изза сбоя в секторе черти в каком файле нам не нужном предлагает переформатировать всю память
теперь сначала проверяются таблицы кластеров и файлов затем сами файлы и затем все пространство памяти целиком
-исправлена индикация перегрузки. теперь все время верхний предел и снизу слова перегрузка и т.д.
-сделано автоматическое определение скорости соединения с GPS модулем
-добавлен режим INFO который отображает важную информацию об ошибках после включения прибора
-добавлено отслеживание настроек system.ini по умолчанию, если таковые есть, то будет постоянно появлятся сообщение в INFO
-добавлено определение наличия GPS приемника, если такового нет то сообщение выводится в режиме GPS
-исправлено определение разряженности батарей в начале инициализации устройства
-исправлена ошибка с размером буферов приема передачи USB и Bluetooth


версия 4.1(А)(В)
29/11/2012
-добавлен режим тревоги тихий (без вибро и звука)
-функция записи режима тревоги в файл system.ini перенесена в выключение прибора для минимизации записей в процессе работы и переключения
-язык интерфейса пользователя определяется при самом включении и соответственно применяется сразу
-исправлено ожидание набора спектра в режиме стабилизации, теперь минимум 5 секунд ожидания.

версия 4.2(А)(В)
03/11/2012
-исправлен вывод информации о спутниках GPS в режиме GSV


версия 4.3(А)(В)
18/01/2013
-формат записи идентифицированных нуклидов в файле спектра приведен в соответствии с АТ6101С

версия 4.4(A)(B)
21/03/2013
-исправлен вывод результата идентификации с НИЧЕГО на НЕИЗВЕСТНЫЙ если чтото есть но неизвестно что
-при ручной записи спектра в режиме РИД и если спектр с таким именем уже существует, к заданному имени добавляется добавка числовая и это имя показывается в спец режиме сообщений
-в режиме РИД не будет выводится категория нуклида
-данные МД и СС и ГПС и температуры теперь привязываются к спектру на момент каждого его чтения из анализатора, а не в момент записи в память как было ранее.

