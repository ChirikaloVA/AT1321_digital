release notes

08/11/2008
added support for keyboard pushing: long first push, and then short repeation, pushing time calculation in ms
added support for clock: initial startup, retrieving clock data
set perepherial divider on 2 for 18.432MHz and on 8 for 73.728MHz so we will have 9.216MHz as pclk

01/12/2008
added catch and processinf of interrupt of processor exception
output:
exception name
registers R0-R14, SPSR
clicking on any key instead of POWER will turnoff device
--
keyboard procedures corrected well
test sound: using WAV and NOTES, bit WAV is BAD
остается не решенной проблема качесвтенного вывода звука
есть идея преобразовывать WAV в данные периодов между 1 и 0 и 1 и т.д.

10/12/2008
added GPS support, NMEA parser, tested!
added Bluetooth support, not tested, and without protocol
added interproc support, not tested, and without protocol
now we play 8bit wav
added bluetooth and gps symbols in status line and controlling them
OLED is burning it self through the time!!!
added support for watchdog, tested!

13/12/2008
realized right way to sleep and power off mode, correct process of keys and show endup screens
realized GREEN LED blinking in time of power down mode
realized auto switch to sleep mode after reach some time


31.12.2008

change processing of battery voltage retrieving, before: manually in main cycle, now in interrupts
SAFE MODE variable using now is changed. before: VIC disabling, now IRQ and FIQ disabling

01.12.2008
write very rapid method of drawing horz and vert lines and by xor too


08.01.2009
eeprom works well,now i need to write variable saving and restoring


14/01/2009
made wakeup from second proc by INT1 (not tested)
made first pre-release of file system, sectors,clasters,claster table, filerecord table
made test of filesystem data at the beginning
made read measurement data from seconds proc
made yes no mode foq requests


17/01/09
отлажены процедуры записи и чтения файлов
сделан тест памяти и всей файловой системы, а также запрос на восстановление если есть сбой.
	При этом восстанавливается вся файловая система, все файлы удаляются.
	Если отказаться о восстановления, то при след старте будет повторный запрос и т.д. а также отказ может привести
	к исключениям в процессе работы.
Сделан плавный скролинг части экрана и использован для движения ДСС (диаграмма скоростей счета)
	диаграма двигается 3 раза в сек, макс скорость 4,3 точки в секунду
изменен средний шрифт на более тонкий
сделан сброс нажатия кнопок перед входом в основной цикл
увеличено время ожидания ответа с 200 до 300 мс для теста ошибки таймаут, продположительно изза малого времени она возникает

21/01/09
реализована работа с INI файлами, надо тестить, ниразу не проверялась!
проверено пробуждение от второго проца по обнаружению
подключили алгоритм идентификации, свертка есть. результат ид неизвестен, нет калибровок

24.01.09
проверена работа с ини. запсиь и чтение.
сделана запись и чтение компрессированног спектра в/из файла тестового
с большинства структур снят volatile, а установлен только для необх переменных

27/01/2009
сделано чтение запись спектров в сжатом ввиде в файловую систему
сделано чтение калибровок по энергии и сигме, они храняться так же как и спектры в сжатом виде.
сделано чтение библ нукл из ини файла
сделано восстановление всех восстанавливаемых системных данных: ини файлов. калибровки по энергии сигме не восстанавливаются,
	т.к.они уникальны
!делается выключение второго проца: надо будет тестировать.
сделан переход в режим загрузчика через меню опций. надо тестить

31/01/09
реализован, но не проверен обмен по УЗБ следующи образом
1. команды с адресом 2 считаются командами к СПиРиДу
2. команды с адресом 1 считаются командами ко второму процессору
2.1. этим командам меняют адрес на 2 и отправляют второму процу
2.2. управляющий по адресу ответа распределяет его между диспетчерам интерпроца и узб
- необходимо реализовать поддержку команд с адресом 2 в программе второго процессора
- в режим обмена по узб попадаем при приеме первой команды по узб независимо от текущего режима,
	кроме режима запроса.
- выход из режима обмена по узб по кнопке


02/02/2009
надо сделать коррекцию часов по гринвичу от ГПС, при этом надо сделать параметр часовой пояс
сделано, что оранж лед и символ гпс будет гореть есл вкл гпс, но нет фикс, если фикс есть то все это будет мерцать


04/02/09
сделаны функции чтения директории, файла, записи файла, создания и удаления файла для работы по
	интерфейсу УЗБ !!!не тестировано!!!
	

07/02/09
необходимо сделать восстановление работы после сбоя через некоторое время
сделано, что если по кнопке то выкл, иначе по таймеру перезапуск

08/02/09
сделана поддержка четырех языков

14/02/09
сделано управление клавиатурой через программу менеджер, а также установку календаря и часов через нее же.
все это сделано через запись и исполнение исполняемого файла execute.sys который схож по структуре с ini файлом.

18/02/2009
отлажен обмен по USB и  Bluetooth. Все работает!
построена последовательность режимов так ка это должно быть
сделан режим MCS
ранее уже было сделано чтение калибровки энергии и сигмы из таблицы значений и расчет сплайна в таблицы канал энергия и канал сигма
изменен принцип работы режима РИД, теперь более удобно работать со спектром
изменен принцип работы режима СПРД, теперь более удобно работать со спектром

19/02/09
сделано отображение дозы в режиме ТС и сброс ее показания
сделана обработка перегрузки и превышение порога безопасности


20/02/09
сделан режим прошивания второго процессора если при включении сначала нажать и удержать вправо а затем вниз.
после появления служ сообщений кнопки можно отпустить. Необходимо запустить at200.exe. после окончания прошивки
нажать кнопку вниз для выключения прибора.
содержимое bat файла для второго процессора (обязательное отключение эхо):
at200 com4 --echo -baud 57600 -flash SPiRiD2.hex

Прошивка первого процессора осуществляется сначала нажатиаем и удержанием кнопки влево а затем кнопки вниз.
Удерживать кнопки все время прошивки до окончания. Затем отпустить.

содержимое bat файла для первого процессора:
at200 com4 -baud 230400 -LPC2478 -flash d:\IARARMProjects\SPRD2\Debug\Exe\SPiRiD1.hex


21/02/09
счас сделано так, что сохранить спектр можно будет только набираемый
сделано полное наполнение файла спекта, ранее были недочеты
сделано создание файлов спектров энергий и сигм после включения прибора
сделан контроль вводимого числового значения на заданные пределы, если не соответствует,
	то продолжаем редактирование без сообщений
ВАЖНО! счас сохранение спектров происходит с перезаписью существующего если таковой есть и без запроса на разрешение


24/02/09
сделан режим жесткого сброса через включение с удержанием кнопок вверх и вниз
затем надо подтвердить и ввести пароль


26/02/09
изменен размер кластера файловой системы, теперь он равен одному сектору, ранее был равен четырем секторам.
это позволит сохранить почти в два раза больше спектров в памяти, т.к. каждый спектр занимал порядка 1300 байт
А также я сдвинул область файловой системы на четыре сектора, теперь есть 4-е свободных сектора в начале,
для сохранения информации о версии, например.

сделан журнал: он ведется от включения до выключения прибора
сделано сохранение файла скоростей счета в режиме МКД по кнопке сохран. в него пишуться дата время гпс
	и имя файла спектра
	

28/02/09
исправлен ряд ошибок чтения строк из файла
сделан режим просмотра журнала: идем от начала и до конца, затем сразу в начало

11/03/09
убраны в system.ini пороги поисковые в сигмах, вместо них используем период ложных тревог, при запуске прибора,
идет чтение периодов и расчет порогов.


13/03/09
добавлен уровень достоверности к идентифицированным нуклидам
исправлен серьезный глюк с индексацией кластеров, использовались ошибочные определения начального и конечного индексов
надо проверять!!!!

20/03/09
весь код переработан на использование FIO на портах. Надо проверять!!!


17/02/2010
убрана палка в спрд/мкд режиме на диаграме
добавлены режимы: NaI mode, GM mode предназначенные для измерения по NaI и GM


весрия 1.2
20/02/2010
добавлен лог режим просмотра спектра
меню второго маркера убрано и заменено подрежимом на кнопке UP
сделана стартовая страница информации о приборе при включении
перетасованы подрежимы в режиме ОПЦИИ
оптимизирован по скорости получения количества файлов подрежим ПАМЯТЬ
оптимизирована работа с индикатором заряда разряда
исправлена ошибка открытия спектра если в каталоге был спектр с максимальной длинной имени
режим ТС теперь не усыпает
в меню режима связь убран пункт тип связи


версия 1.5
09/04/2010
лог это теперь один большой файл log.log
он дополняется всегда если есть и создается новый если его нет
автофайлы теперь в имени содержат ммддччммсс (месяц, день, час, минуты, секунды)


версия 1.6
15/04/2010
в режиме РИД теперь скорость счета мгновенная отображается, также появилась мощность дозы гамма-излучения, площадь найденного пика
появился звук на окончание набора спектра
исправлен вывод журнал. просмотр с последнего события до первого


версия 1.7
19/04/2010
добавлено автосохранение спектра в режиме RID если наступает разряд аккумуляторов.


версия 1.8
22/04/2010
блокирована идентификация нуклидов во время перегрузки NaI и превышения порога безопасности
блокировано усыпание прибора во время обмена по USB и Bluetooth


версия 1.9
24/06/2010
заблокировано выключение экрана в режимах ГМ и NaI
расширен диапазон значения порога радиационной тревоги до 1000 мкЗв/ч
расширены границы расчета скорости счета импульсов в пике до 3,5 сигм.

версия 1.10
29/06/2010
маркер спектра перекрашен в зеленый


версия 1.11
13/07/2010
исправлена ошибка длины буфера еепром в некоторых местах

версия 2.0
27/08/2010
исправлен алгоритм идентификации, обновлена главная библиотека
в режиме RID вместо моментальной скорости счета импульсов выведена средняя скорость счета с учетом мертвого времени


версия 2.1
24/09/2010
добавлен счетчик записей еепром, и регенерация еепром при включении питания прибора и достижении 9500 записей, 
счетчик пишется в еепром только по правильному выключению питания прибора, или по записи серийного номера с ПК или после регенерации когда обнуляется на 0
изменено название кнопки выбора источника в режиме стабилизации, тип источника подсвечивается на экране красным цветом
некоторые стар сообщения теперь не попадают в лог


версия 2.2
27/09/2010
разрешена запись в еепром данных о выключении прибора при разряженных батареях
перемещен подрежим память вторым по списку после версии в режиме опции
реализован подзапрос на удаление автофайлов при заполнении памяти до предела
реализован в режиме RID пункт меню удалить автоспектры для очистки памяти
добавлено отображение фоновой скорости счета в режиме TC
теперь в лог пишется МД того детектора который счас активен по той или иной причине
реализована возможность в режиме спрд сохранять значение МД в лог через меню
сделано добавление информации позиционирования (если вкл GPS и есть фиксация) во время тревоги, перегрузки, ручного сохранения МД.
изменены функции кнопок в режиме SPRD, добалвен пункт меню РЕЖИМ ФОН
вместо значения таймаута дежурного теперь выводится количество перезаписей памяти
подправлены значения минимального и критического напряжения батареи в низ
скорректирована библиотека нуклидов по Ra226.


версия 2.3
08/11/2010
исправлен порог вероятности по расчету порога обнаружения по методу пуассону на 0,05. Ранее порог был ошибочен.


версия 2.4
30/11/2010
исправлен алгоритм идентификации нуклидов по части идентификации Pu+Ba и также улучшена идентификация am-241 которая ухудшилась в связи с утоньшением сигмы


версия 2.5
11/01/2011
в режим просмотра параметров батареи добавлен пункт меню калибровочный коэффициент батареи, коэффициент теперь множится на значение АЦП после измерения напряжения.


версия 2.6
10/02/2011
исправлено: в режимах с выпадающим меню вызвать меню дождаться перехода в режим дежурный/ожидания пробудить и перемещать маркер кнопками, итог: меню нет, маркер будет двигаться.

версия 2.7
28/03/2011
исправлено: некорректное использование типа char. по умолчаиню он unsinged. переделано на CHAR который signed

версия 2.8
14/04/2011
исправлено: аварийное сохранение спектра если разряжена батарея  врежиме спектрометра
есть ошибка в расчете реального времени

версия 2.9
26/04/2011
убрано переключение единиц измерения мощности дозы
убрано отображение минимальной энергии в окне библ нуклидов

версия 3.0
29/04/2011
убраны щелчки при выводе звука
единицы измерения приведены в соответствии с техрегламентом

версия 3.1
11/05/2011
исправлено аварийное выключение прибора с порчей файловой системы при удалении файла скриншота экрана после его получения
добавлена сигнализация в режиме таймер каунтер при превышении расчетного порога
несколько мелких исправлений текстов


версия 3.2
30/05/2011
добавлен режим моста  между узб и блутуз, переход в режим по команде из RadSearcher Manager. Выход только перезапуск прибра.
улучшена эффективность при определении перехода в режим дежурный.
исправлен старт блутуза
исправлена ошибка включения режима моста
изменено поведение при обнаружении сбоя в номерах кластеров файлов, теперь файл удаляется вместо переформатирования файловой системы

версия 3.3
06/06/2011
устранена ошибка замедления выполнения связанная с выключением экрана.

версия 3.4
08/07/2011
обработка спектра в алгоритме стабилизации происходит с сигмой калибровочного значения (т.е. не зауженной сигмой), что дает более качественный поиск пика

версия 3.5
26/07/2011
улучшена идентификация PuBa
исправлен ввода дня месяца, теперь идет расчет количества дней от введенного года и месяца

версия 3.6
13/09/2011
исправлен нижний предел значения коэффициента батареи
введена проверка и исправление значения коэффициента батареи по пределам при чтении из еепром
исправлено лишнее появление меню при переходе из режима ГМ или НаИ в СПРД
значение периода ложных тревог в 14400 на русском теперь помещается на экране.
при выходе из дежурного режима по кнопке, ее функция не отпработает пока не отпустить и не нажать кнопку снова

